create table applications (id int8 generated by default as identity, date timestamp, card_photo varchar(512) not null, student_id int8, primary key (id));
create table chats (id int8 generated by default as identity, primary key (id));
create table chats_messages (chat_id int8 not null, messages_id int8 not null, primary key (chat_id, messages_id));
create table chats_users (chat_id int8 not null, user_id int8 not null, primary key (chat_id, user_id));
create table comments (id int8 generated by default as identity, rating float8, author_id int8, primary key (id));
create table dormitories (id int8 generated by default as identity, title varchar(255) not null, capacity_rating float8, cleaning_rating float8, roommates_rating float8, university_id int8, primary key (id));
create table dormitories_students (dormitory_id int8 not null, students_id int8 not null, primary key (dormitory_id, students_id));
create table dormitory_photos (dormitory_id int8 not null, photos varchar(512));
create table faculties (id int8 generated by default as identity, title varchar(255) not null, education_rating float8, price_rating float8, university_id int8, primary key (id));
create table faculties_students (faculty_id int8 not null, students_id int8 not null, primary key (faculty_id, students_id));
create table faculties_teachers (faculty_id int8 not null, teacher_id int8 not null, primary key (faculty_id, teacher_id));
create table faculty_photos (faculty_id int8 not null, photos varchar(512));
create table messages (id int8 generated by default as identity, author_id int8, chat_id int8, primary key (id));
create table students (id int8 generated by default as identity, course int4 not null, first_name varchar(64) not null, gender varchar(64) not null, last_name varchar(64) not null, patronymic varchar(64) not null, account_id int8, dormitory_id int8, faculty_id int8, university_id int8, primary key (id));
create table teacher_excuses (teacher_id int8 not null, excuses varchar(1024));
create table teacher_photos (teacher_id int8 not null, photos varchar(512));
create table teachers (id int8 generated by default as identity, title varchar(255) not null, age int4, exacting_rating float8, first_name varchar(255) not null, freebies_rating float8, last_name varchar(255) not null, patronymic varchar(255) not null, severity_rating float8, primary key (id));
create table teachers_students (teacher_id int8 not null, student_id int8 not null, primary key (teacher_id, student_id));
create table universities (id int8 generated by default as identity, title varchar(255) not null, abbreviation varchar(32), bachelor boolean, complexity_rating float8, magistracy boolean, price_rating float8, specialty boolean, utility_rating float8, primary key (id));
create table universities_dormitories (university_id int8 not null, dormitories_id int8 not null, primary key (university_id, dormitories_id));
create table universities_faculties (university_id int8 not null, faculties_id int8 not null, primary key (university_id, faculties_id));
create table universities_students (university_id int8 not null, students_id int8 not null, primary key (university_id, students_id));
create table universities_teachers (university_id int8 not null, teacher_id int8 not null, primary key (university_id, teacher_id));
create table university_photos (university_id int8 not null, photos varchar(512));
create table user_roles (user_id int8 not null, roles varchar(64));
create table users (id int8 generated by default as identity, active boolean, email varchar(255), photo varchar(512), password varchar(255) not null, username varchar(255) not null, primary key (id));
create table users_comments (user_id int8 not null, comments_id int8 not null, primary key (user_id, comments_id));
create table users_messages (user_id int8 not null, messages_id int8 not null, primary key (user_id, messages_id));
alter table if exists chats_messages add constraint chats_messagesID_uk unique (messages_id);
alter table if exists dormitories add constraint dormitories_title_uk unique (title);
alter table if exists dormitories_students add constraint dormitories_studentsID_uk unique (students_id);
alter table if exists faculties add constraint faculties_title_uk unique (title);
alter table if exists faculties_students add constraint faculties_studentsID_uk unique (students_id);
alter table if exists students add constraint unique_account unique (account_id);
alter table if exists teachers add constraint teachers_title_uk unique (title);
alter table if exists universities add constraint universities_title_uk unique (title);
alter table if exists universities_dormitories add constraint universities_dormitoriesID_uk unique (dormitories_id);
alter table if exists universities_faculties add constraint universities_facultiesID_uk unique (faculties_id);
alter table if exists universities_students add constraint universities_studentsID_uk unique (students_id);
alter table if exists users add constraint users_email_uk unique (email);
alter table if exists users add constraint users_username_uk unique (username);
alter table if exists users_comments add constraint users_commentsID_uk unique (comments_id);
alter table if exists users_messages add constraint users_messagesID_uk unique (messages_id);
alter table if exists applications add constraint applications_students_fk foreign key (student_id) references students;
alter table if exists chats_messages add constraint chats_messagesID_fk foreign key (messages_id) references messages;
alter table if exists chats_messages add constraint chatsID_messages_fk foreign key (chat_id) references chats;
alter table if exists chats_users add constraint chats_usersID_fk foreign key (user_id) references users;
alter table if exists chats_users add constraint chatsID_users_ foreign key (chat_id) references chats;
alter table if exists comments add constraint comments_author_fk foreign key (author_id) references users;
alter table if exists dormitories add constraint dormitories_university_fk foreign key (university_id) references universities;
alter table if exists dormitories_students add constraint dormitories_studentsID_fk foreign key (students_id) references students;
alter table if exists dormitories_students add constraint dormitoriesID_students_fk foreign key (dormitory_id) references dormitories;
alter table if exists dormitory_photos add constraint dormitory_photos_fk foreign key (dormitory_id) references dormitories;
alter table if exists faculties add constraint faculties_university_fk foreign key (university_id) references universities;
alter table if exists faculties_students add constraint faculties_studentsID_fk foreign key (students_id) references students;
alter table if exists faculties_students add constraint facultiesID_students_fk foreign key (faculty_id) references faculties;
alter table if exists faculties_teachers add constraint faculties_teacherID_fk foreign key (teacher_id) references teachers;
alter table if exists faculties_teachers add constraint facultiesID_teacher_fk foreign key (faculty_id) references faculties;
alter table if exists faculty_photos add constraint faculty_photos_fk foreign key (faculty_id) references faculties;
alter table if exists messages add constraint messages_author_fk foreign key (author_id) references users;
alter table if exists messages add constraint messages_chat_fk foreign key (chat_id) references chats;
alter table if exists students add constraint students_account_fk foreign key (account_id) references users;
alter table if exists students add constraint students_dormitory_fk foreign key (dormitory_id) references dormitories;
alter table if exists students add constraint students_faculty_fk foreign key (faculty_id) references faculties;
alter table if exists students add constraint students_university_fk foreign key (university_id) references universities;
alter table if exists teacher_excuses add constraint teacher_exuses_fk foreign key (teacher_id) references teachers;
alter table if exists teacher_photos add constraint teacher_photos_fk foreign key (teacher_id) references teachers;
alter table if exists teachers_students add constraint teachers_studentsID_fk foreign key (student_id) references students;
alter table if exists teachers_students add constraint teachersID_students_fk foreign key (teacher_id) references teachers;
alter table if exists universities_dormitories add constraint universities_dormitoriesID_fk foreign key (dormitories_id) references dormitories;
alter table if exists universities_dormitories add constraint universitiesID_dormitories_fk foreign key (university_id) references universities;
alter table if exists universities_faculties add constraint universities_facultiesID_fk foreign key (faculties_id) references faculties;
alter table if exists universities_faculties add constraint universitiesID_faculties_fk foreign key (university_id) references universities;
alter table if exists universities_students add constraint universities_studentsID_fk foreign key (students_id) references students;
alter table if exists universities_students add constraint universitiesID_students_fk foreign key (university_id) references universities;
alter table if exists universities_teachers add constraint universities_teachersID_fk foreign key (teacher_id) references teachers;
alter table if exists universities_teachers add constraint universitiesID_teachers_fk foreign key (university_id) references universities;
alter table if exists university_photos add constraint university_photos_fk foreign key (university_id) references universities;
alter table if exists user_roles add constraint user_roles_fk foreign key (user_id) references users;
alter table if exists users_comments add constraint users_commentsID_fk foreign key (comments_id) references comments;
alter table if exists users_comments add constraint usersID_comments_fk foreign key (user_id) references users;
alter table if exists users_messages add constraint users_messagesID_fk foreign key (messages_id) references messages;
alter table if exists users_messages add constraint usersID_messages_fk foreign key (user_id) references users;